<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Hola mundo</h1>

    <button class="ON" onclick="turnOn()">ON</button>
    <button class="OFF" onclick="turnOff()">OFF</button>

    <div>
        <h2>Distance</h2>
        <h2 class="dist_value"></h2>
    </div>


    <script>

        const boton1 = document.querySelector('.ON')
        const boton2 = document.querySelector('.OFF')

        let socketConnection = new WebSocket('ws://' + location.hostname + ':81/');

        const turnOn = () => socketConnection.send("LedOn")
        const turnOff = () => socketConnection.send("LedOff")


        boton1.addEventListener('click', ()=>{

            // socketConnection.send('LedOn');
            console.log('ON')

        })

        boton2.addEventListener('click', ()=>{
            // socketConnection.send('LedOff')
            console.log('OFF')

        })

        socketConnection.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
        
                if (data.distance !== undefined) {
                    let value = data.distance;
                    UpdateDist(value);
        
                    if (value > 10) {
                        socketConnection.send("LedOn");
                        console.log("Enviando a llenar");
                    } else {
                        socketConnection.send("LedOff");
                        console.log("Detener llenado");
                    }
                } else if (data.status) {
                    console.log("Estado del servidor:", data.status);
                }
            } catch (error) {
                console.error("Error al parsear el mensaje:", error, "Mensaje recibido:", event.data);
            }
        };
        


        function UpdateDist(value){

            const space = document.querySelector(".dist_value");

            space.innerHTML = `${value}<span>cm</span>`;


        }

    </script>
</body>
</html>